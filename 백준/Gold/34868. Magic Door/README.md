# [Gold I] Magic Door - 34868 

[문제 링크](https://www.acmicpc.net/problem/34868) 

### 성능 요약

메모리: 33948 KB, 시간: 272 ms

### 분류

구현, 시뮬레이션

### 제출 일자

2026년 1월 29일 16:48:20

### 문제 설명

<p><img alt="" src="https://upload.acmicpc.net/ce2a3797-285f-48db-8b31-db496d315f5c/-/preview/" style="width: 112px; height: 148px; float: right;">The magic door to a treasure cave is an $m \times n$ grid filled with various gems. The gems fall into three categories: <strong>regular gems</strong> of various colors and shapes, and two special types - <strong>bomb gems</strong> and <strong>vibranium gems</strong>.</p>

<p>A <em>match-3 group</em> is a group of three or more identical regular gems aligned consecutively in a vertical or horizontal direction. A single gem may belong to both a horizontal match3 group and a vertical match-3 group at which they intersect each other. Bomb gems do not form match-3 groups. Vibranium gems do not either.</p>

<p>In the initial state of the grid, no match-3 groups exist. When you initially touch two regular gems with your hand, they swap their positions. This single swap triggers a chain reaction that causes the gems to disappear from the grid according to a set of specific rules.</p>

<p>After the initial swap, the following process repeats until no more changes occur on the grid:</p>

<ul>
<li>Stage 1: Chain Reactions of Match-3 Groups
<ol>
<li>All gems belong to every match-3 group disappear simultaneously.</li>
<li>All types of gems above the vanished gems fall downward due to gravity, filling the empty spaces. During this process, any bomb gem that moves down by at least one cell becomes activated.</li>
<li>If new match-3 groups are formed after the gems fall, this stage repeats from the first sub-step.</li>
<li>If no more match-3 groups are formed, proceed to Stage 2.</li>
</ol>
</li>
<li>Stage 2: Activated Bomb Detonation
<ol>
<li>All bombs currently in the activated state explode simultaneously.</li>
<li>Each exploding bomb emits beams in horizontal and vertical directions.</li>
<li>The beams travel from the bomb's position to the grid edge.</li>
<li>A beam's path is blocked if it hits a vibranium gem.</li>
<li>All regular gems and bombs on the beam’s path disappear along with the exploded bomb.</li>
<li>Unexploded bombs hit by a beam simply disappear without exploding.</li>
<li>The gems above the vanished gems fall downward due to gravity, filling the newly created empty spaces. During this process, any bomb that moves down by at least one cell becomes activated. Then Stage 1 repeats.</li>
</ol>
</li>
</ul>

<p>Once no more changes occur due to Stage 1 and Stage 2, the entire process is terminated. Note that bomb gems and vibranium gems are not selected from the initial swap and do not form match-3 groups. Also note that any vibranium gem never disappears, acts as a barrier blocking the bomb's beam, and it is affected by gravity and will fall into empty spaces below it.</p>

<p>For example, consider a magic door composed of a $6 \times 4$ grid, as shown in Figure 1. In the figure, <code>0</code> represents a bomb gem, <code>-1</code> represents a vibranium gem, and positive numbers represent regular gems. Starting from the initial state shown in the figure (a), swapping the two gems located at $(6, 1)$ and $(5, 4)$ results in the state shown in (b). The location $(r, c)$ denotes the cell in the $r$-th row from the top and the $c$-th column from the left. Coordinates are $1$-based. This state contains a match-3 group consisting of three <code>2</code>s. According to Stage 1, when the gems in this group disappear, state (c) is reached. At this point, the bomb gem at $(4, 3)$ is activated and a new match-3 group consisting of three <code>1</code>s is formed. Again, Stage 1 removes the three gems of <code>1</code>, resulting in state (d). Since no match-3 groups remain, the bomb explodes due to Stage 2. This results in state (e). Here, two match-3 groups consisting of three <code>1</code>s and four <code>3</code>s are formed. Again, when these gems disappear due to Stage 1, state (f) is reached. No further changes occur in this state, making it the final state. A total of $18$ gems disappear during this process.</p>

<p style="text-align: center;"><img alt="" src="https://upload.acmicpc.net/01998ba4-668e-41bf-8846-eb3ff8fb84ab/-/preview/" style="width: 659px; height: 157px;"></p>

<p style="text-align: center;"><strong>Figure 1</strong>. Chain Reactions</p>

<p>The magic door opens when a specific number of gems disappear. Your task is to write a program that, given the information about the magic door and the positions of the two regular gems to be swapped, calculates the number of gems that disappeared after the entire chain reaction, initiated by a single swap, comes to a complete stop.</p>

### 입력 

 <p>Your program is to read from standard input. The input starts with a line containing two integers, $m$ and $n$ ($3 ≤ m ≤ 80$; $3 ≤ n ≤ 80$), representing the number of rows and columns of the grid. The next $m$ lines each contain $n$ integers, representing the gems in each row of the grid, where <code>0</code> represents a bomb gem, <code>-1</code> represents a vibranium gem, and integers between $1$ and $9$ inclusive represent regular gems. The final line contains four integers, $r_1$, $c_1$, $r_2$, $c_2$ ($1 ≤ r_1, r_2 ≤ m$; $1 ≤ c_1, c_2 ≤ n$), where $(r_1, c_1 )$ and $(r_2, c_2 )$ represent the coordinates of the two distinct regular gems to be swapped. The coordinates are $1$-based.</p>

### 출력 

 <p>Your program is to write to standard output. Print exactly one line. The line should contain an integer representing the total number of gems that will disappear after all processes have been completed.</p>

